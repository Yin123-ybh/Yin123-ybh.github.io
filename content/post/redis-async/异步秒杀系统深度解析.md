---
title: "å¼‚æ­¥ç§’æ€ç³»ç»Ÿæ·±åº¦è§£æï¼ˆå«Redisé¢„æ‰£åº“å­˜ä¸æ¶ˆæ¯é˜Ÿåˆ—å®ç°ï¼‰"
date: 2025-09-17
draft: false
tags: ["Java", "Redis", "RabbitMQ", "ç§’æ€ç³»ç»Ÿ", "é«˜å¹¶å‘", "åˆ†å¸ƒå¼ç³»ç»Ÿ", "å¼‚æ­¥å¤„ç†"]
categories: ["é«˜å¹¶å‘ç³»ç»Ÿ"]
description: "æ·±å…¥è§£æå¼‚æ­¥ç§’æ€ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ï¼ŒåŒ…æ‹¬Redisé¢„æ‰£åº“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ã€å‰åç«¯è§£è€¦ç­‰æ ¸å¿ƒæŠ€æœ¯ï¼Œé€šè¿‡è¯¦ç»†ä»£ç ç¤ºä¾‹å’Œé€šä¿—ç±»æ¯”å¸®åŠ©ç†è§£é«˜å¹¶å‘ç§’æ€ç³»ç»Ÿçš„æ ¸å¿ƒåŸç†"
---

# å¼‚æ­¥ç§’æ€ç³»ç»Ÿæ·±åº¦è§£æï¼ˆå«Redisé¢„æ‰£åº“å­˜ä¸æ¶ˆæ¯é˜Ÿåˆ—å®ç°ï¼‰

ç§’æ€ç³»ç»Ÿæ˜¯ç”µå•†é«˜å¹¶å‘åœºæ™¯çš„å…¸å‹åº”ç”¨ï¼ŒçŸ­æ—¶é—´å†…å¤§é‡ç”¨æˆ·åŒæ—¶æŠ¢è´­æœ‰é™å•†å“ï¼Œå¦‚ä½•ä¿è¯åº“å­˜ä¸è¶…å–ã€ç³»ç»Ÿé«˜å¯ç”¨ã€å“åº”å¿«é€Ÿï¼Œæ˜¯æŠ€æœ¯è®¾è®¡çš„æ ¸å¿ƒé—®é¢˜ã€‚æœ¬æ–‡å°†ç»“åˆå¼‚æ­¥ç§’æ€æ€è·¯ã€Redisåº“å­˜é¢„æ‰£ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å‰åç«¯è§£è€¦ç­‰æŠ€æœ¯ç‚¹ï¼Œæ·±å…¥è®²è§£ç§’æ€ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ï¼Œå¹¶ç”¨ç±»æ¯”å’Œæµç¨‹è§£æï¼Œå¸®åŠ©ä½ ç†è§£é«˜å¹¶å‘å¤„ç†èƒŒåçš„åŸç†ã€‚

---

## 1ï¸âƒ£ ç§’æ€åœºæ™¯é—®é¢˜åˆ†æ

ç§’æ€åœºæ™¯ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **é«˜å¹¶å‘**ï¼šçŸ­æ—¶é—´å†…æˆåƒä¸Šä¸‡ç”¨æˆ·æŠ¢è´­åŒä¸€å•†å“
- **åº“å­˜æœ‰é™**ï¼šå•†å“æ•°é‡æœ‰é™ï¼Œå¿…é¡»ä¸¥æ ¼æ§åˆ¶
- **ç³»ç»Ÿå‹åŠ›å¤§**ï¼šæ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ

### å¸¸è§é—®é¢˜ï¼š

1. **è¶…å–**ï¼šåº“å­˜è¢«å¤šæ¬¡æ‰£å‡ï¼Œå–å‡ºè¶…è¿‡å®é™…æ•°é‡
2. **æ•°æ®åº“å‹åŠ›å¤§**ï¼šå¤§é‡è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“ï¼Œå®¹æ˜“å¯¼è‡´å®•æœº
3. **ç½‘ç»œå»¶è¿Ÿå’Œå“åº”æ…¢**ï¼šç”¨æˆ·ä½“éªŒå·®
4. **å¹¶å‘äº‹åŠ¡å†²çª**ï¼šæ™®é€šé”æˆ–äº‹åŠ¡å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ

### é—®é¢˜ä»£ç ç¤ºä¾‹ï¼ˆé”™è¯¯å®ç°ï¼‰

```java
// âŒ é”™è¯¯å®ç°ï¼šç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œå®¹æ˜“è¶…å–
@RestController
public class SeckillController {
    
    @Autowired
    private ProductService productService;
    
    @Autowired
    private OrderService orderService;
    
    @PostMapping("/seckill")
    public Result seckill(@RequestParam Long productId, @RequestParam Long userId) {
        // 1. æŸ¥è¯¢åº“å­˜
        Product product = productService.getById(productId);
        if (product.getStock() <= 0) {
            return Result.fail("åº“å­˜ä¸è¶³");
        }
        
        // 2. æ‰£å‡åº“å­˜ - è¿™é‡Œå¯èƒ½å‡ºç°è¶…å–ï¼
        product.setStock(product.getStock() - 1);
        productService.updateById(product);
        
        // 3. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setProductId(productId);
        order.setUserId(userId);
        orderService.save(order);
        
        return Result.success("ç§’æ€æˆåŠŸ");
    }
}
```

---

## 2ï¸âƒ£ åŒæ­¥ vs å¼‚æ­¥ç§’æ€

ç§’æ€å¤„ç†å¯ä»¥åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š

| æ–¹å¼ | ç”¨æˆ·è¯·æ±‚ | åç«¯å¤„ç† | ä¼˜ç¼ºç‚¹ |
|------|----------|----------|--------|
| **åŒæ­¥** | ç”¨æˆ·è¯·æ±‚ç›´æ¥è°ƒç”¨æ•°æ®åº“ | ç«‹å³å¤„ç†åº“å­˜å’Œè®¢å• | é«˜å¹¶å‘ä¸‹æ•°æ®åº“å‹åŠ›å¤§ï¼Œå®¹æ˜“é˜»å¡ï¼Œè¶…å–é£é™©é«˜ |
| **å¼‚æ­¥** | ç”¨æˆ·è¯·æ±‚å…ˆè¿›å…¥é˜Ÿåˆ—æˆ–ç¼“å­˜ | åå°å¼‚æ­¥æ¶ˆè´¹é˜Ÿåˆ—ï¼Œä¾æ¬¡å¤„ç†åº“å­˜å’Œè®¢å• | å¿«é€Ÿå“åº”ç”¨æˆ·ï¼Œå‰Šå³°å¡«è°·ï¼Œé˜²æ­¢è¶…å– |

### æ ¸å¿ƒåŒºåˆ«ï¼š

- **åŒæ­¥æ¨¡å¼**ï¼šå‰ç«¯ç­‰å¾…åç«¯å®Œæˆæ‰€æœ‰æ“ä½œ
- **å¼‚æ­¥æ¨¡å¼**ï¼šå‰ç«¯è¯·æ±‚å…ˆæ’é˜Ÿï¼Œåå°æ…¢æ…¢å¤„ç†ä¸šåŠ¡ï¼Œè¯·æ±‚å¤„ç†ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦

---

## 3ï¸âƒ£ å¼‚æ­¥ç§’æ€æ ¸å¿ƒæ€è·¯

å¼‚æ­¥ç§’æ€é€šè¿‡ä»¥ä¸‹æµç¨‹å®ç°é«˜å¹¶å‘å¤„ç†ï¼š

### æ­¥éª¤ 1ï¼šæ¥æ”¶è¯·æ±‚ï¼ˆæ¥å£å±‚ï¼‰

ç”¨æˆ·ç‚¹å‡»ç§’æ€æŒ‰é’®ï¼Œå‰ç«¯è¯·æ±‚ç§’æ€æ¥å£ã€‚

æ¥å£å±‚å¿«é€Ÿåˆ¤æ–­ï¼š
- å•†å“æ˜¯å¦è¿˜æœ‰åº“å­˜
- ç”¨æˆ·æ˜¯å¦å·²ç»ä¸‹å•

åˆ¤æ–­é€šè¿‡ï¼š
- ä½¿ç”¨ Redis + Lua è„šæœ¬è¿›è¡Œåº“å­˜é¢„æ‰£ï¼ˆåŸå­æ“ä½œï¼‰
- ç”Ÿæˆè®¢å• ID æˆ–è¯·æ±‚ ID
- å°†è¯·æ±‚å°è£…æˆæ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQã€Kafkaã€Redis Stream ç­‰ï¼‰

æ¥å£ç«‹å³è¿”å›ç»™å‰ç«¯ï¼š
- "æ’é˜ŸæˆåŠŸ"æˆ–"è¯·æ±‚å·²æ¥æ”¶"

âš¡ **æ³¨æ„**ï¼šå‰ç«¯ç”¨æˆ·æ­¤æ—¶å¹¶æœªç›´æ¥æ‹¿åˆ°æœ€ç»ˆè®¢å•ï¼Œåªæ˜¯æ‹¿åˆ°ä¸€ä¸ª"æŠ¢è´­å‡­è¯"ã€‚

### æ­¥éª¤ 2ï¼šå¼‚æ­¥å¤„ç†è¯·æ±‚ï¼ˆåå°æœåŠ¡ï¼‰

æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ï¼š
- æ‰£æ•°æ®åº“åº“å­˜
- åˆ›å»ºè®¢å•è®°å½•
- æ ‡è®°ç”¨æˆ·å·²ä¸‹å•

å¤„ç†å®Œæˆåé€šçŸ¥ç”¨æˆ·ï¼š
- ç§’æ€æˆåŠŸï¼ˆè®¢å•ç”ŸæˆæˆåŠŸï¼‰
- ç§’æ€å¤±è´¥ï¼ˆåº“å­˜ä¸è¶³ï¼‰

### æ­¥éª¤ 3ï¼šåº“å­˜æ§åˆ¶

Redisåº“å­˜é¢„å‡ï¼š
- ç§’æ€å‰ï¼Œå°†å•†å“åº“å­˜åŠ è½½åˆ° Redis
- ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œç”¨ Redis åŸå­æ“ä½œ DECR æ‰£å‡åº“å­˜
- æ‰£å‡æˆåŠŸ â†’ æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—
- æ‰£å‡å¤±è´¥ â†’ ç§’æ€ç»“æŸï¼Œè¿”å›å¤±è´¥

å¯ä½¿ç”¨ Lua è„šæœ¬å°† **åˆ¤æ–­åº“å­˜ > 0 + æ‰£å‡åº“å­˜** åšæˆåŸå­æ“ä½œï¼Œé¿å…è¶…å–

### æ­¥éª¤ 4ï¼šç”¨æˆ·é€šçŸ¥

ç§’æ€ç»“æœå¼‚æ­¥è¿”å›ï¼š
- è½®è¯¢æ¥å£
- WebSocket
- æ¶ˆæ¯æ¨é€

å‰ç«¯ç”¨æˆ·æ‹¿åˆ°æœ€ç»ˆç»“æœåï¼Œç¡®è®¤æ˜¯å¦æŠ¢è´­æˆåŠŸ

---

## 4ï¸âƒ£ æ¥å£å±‚å¿«é€Ÿåˆ¤æ–­åº“å­˜ä¸ç”¨æˆ·èµ„æ ¼

æ¥å£å±‚ä¸ºä»€ä¹ˆå¯ä»¥å¿«é€Ÿåˆ¤æ–­åº“å­˜å’Œç”¨æˆ·æ˜¯å¦ç¬¦åˆä¸‹å•è¦æ±‚ï¼Ÿæ ¸å¿ƒæ˜¯æå‰æŠŠå…³é”®æ•°æ®ç¼“å­˜åœ¨ Redisï¼š

### 4.1 åº“å­˜åˆ¤æ–­

ç§’æ€å¼€å§‹å‰ï¼Œå°†å•†å“åº“å­˜åŠ è½½åˆ° Redisï¼š

```
Key: "stock:å•†å“ID"
Value: å‰©ä½™åº“å­˜æ•°é‡
```

è¯·æ±‚åˆ°æ¥æ—¶ï¼š
```redis
DECR stock:å•†å“ID  // åŸå­æ“ä½œ
```

è¿”å›å€¼åˆ¤æ–­ï¼š
- â‰¥0 â†’ åº“å­˜è¿˜æœ‰ï¼Œå…è®¸ä¸‹å•
- <0 â†’ åº“å­˜ä¸è¶³ï¼Œç§’æ€ç»“æŸ

Lua è„šæœ¬å¯å°†"åˆ¤æ–­åº“å­˜ + æ‰£å‡åº“å­˜"åŸå­åŒ–å¤„ç†ï¼Œé¿å…è¶…å–

### 4.2 ç”¨æˆ·æ˜¯å¦å·²ä¸‹å•

æ¯ä½ç”¨æˆ·åªèƒ½ä¸‹å•ä¸€æ¬¡ï¼š

```
Key: "order:ç”¨æˆ·ID:å•†å“ID"
Value: 1  // å·²ä¸‹å•
```

æ¥å£å±‚åˆ¤æ–­ï¼š
```
EXISTS order:ç”¨æˆ·ID:å•†å“ID â†’ å·²ä¸‹å•ï¼Œæ‹’ç»
ä¸å­˜åœ¨ â†’ å…è®¸åŠ å…¥é˜Ÿåˆ—
```

âœ… é€šè¿‡ Redis åˆ¤æ–­åº“å­˜ä¸ç”¨æˆ·çŠ¶æ€ï¼Œå®ç°ç§’æ€æ¥å£å¿«é€Ÿå“åº”ï¼Œé¿å…é«˜å¹¶å‘ç›´æ¥æ‰“æ•°æ®åº“ã€‚

### 4.3 æ¥å£å±‚å®Œæ•´æµç¨‹

1. ç”¨æˆ·å‘èµ·è¯·æ±‚
2. æ¥å£å±‚åˆ¤æ–­åº“å­˜ + ç”¨æˆ·æ˜¯å¦å·²ä¸‹å•
3. åˆ¤æ–­é€šè¿‡ï¼š
   - Redisé¢„æ‰£åº“å­˜ï¼ˆLuaè„šæœ¬ï¼‰
   - ç”Ÿæˆè®¢å•ID
   - æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—
   - è¿”å›"æ’é˜ŸæˆåŠŸ"ï¼Œå‰ç«¯æ— éœ€ç­‰å¾…æ•°æ®åº“æ“ä½œ

---

## 5ï¸âƒ£ å¼‚æ­¥çš„æ€§èƒ½ä¼˜åŠ¿

å¼‚æ­¥æ¨¡å¼æ¯”åŒæ­¥æ¨¡å¼æ€§èƒ½æ›´å¥½ï¼ŒåŸå› åœ¨äºè§£è€¦è¯·æ±‚å¤„ç†å’Œæ•°æ®åº“æ“ä½œï¼Œé¿å…é˜»å¡ï¼š

- **è¯·æ±‚å¤„ç†å¿«**ï¼šçº¿ç¨‹åªåšè½»é‡åˆ¤æ–­ + Redis + æ¶ˆæ¯å…¥é˜Ÿ â†’ ç«‹å³é‡Šæ”¾
- **æµé‡å‰Šå³°å¡«è°·**ï¼šé˜Ÿåˆ—ç¼“å†²é«˜å³°è¯·æ±‚ï¼Œæ•°æ®åº“å¹³æ»‘æ¶ˆè´¹
- **é¿å…è¶…å–**ï¼šRedisåŸå­æ‰£å‡ + é˜Ÿåˆ—é¡ºåºæ¶ˆè´¹
- **ç³»ç»Ÿååé‡é«˜**ï¼šWebå±‚å¿«é€Ÿå“åº” + åç«¯å¤šçº¿ç¨‹æˆ–åˆ†å¸ƒå¼å¤„ç†

### ç±»æ¯”è¯´æ˜

- **åŒæ­¥**ï¼šå‰ç«¯ç›´æ¥ç­‰èœåšå¥½ â†’ é«˜å³°æœŸæ’é•¿é˜Ÿï¼Œå¨æˆ¿å¿™ä¸è¿‡æ¥
- **å¼‚æ­¥**ï¼šå‰ç«¯å…ˆæ‹¿åˆ°å–é¤å· â†’ å¨æˆ¿æŒ‰é¡ºåºåšèœ â†’ ç³»ç»Ÿç¨³å®šï¼Œç”¨æˆ·ä½“éªŒå¥½

---

## 6ï¸âƒ£ æ ¸å¿ƒæŠ€æœ¯å®ç°è¦ç‚¹

| æŠ€æœ¯ç¯èŠ‚ | å®ç°å…³é”® |
|----------|----------|
| æ¥å…¥å±‚ | é™æµï¼ˆNginx/ç½‘å…³ï¼‰é˜²æ­¢è¯·æ±‚æš´æ¶¨ |
| åº“å­˜åˆ¤æ–­ | RedisåŸå­æ“ä½œ DECR + Luaè„šæœ¬ |
| è¯·æ±‚æ’é˜Ÿ | æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ï¼ˆRabbitMQ/Kafka/Redis Streamï¼‰ |
| è®¢å•å¤„ç† | æ¶ˆè´¹ç«¯äº‹åŠ¡å†™æ•°æ®åº“ |
| å»é‡ | ç”¨æˆ·ä¸‹å•å‰æ£€æŸ¥æ˜¯å¦å·²ä¸‹å• |
| å‰Šå³°å¡«è°· | æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯å¹³æ»‘æ¶ˆè´¹ |
| å¹‚ç­‰æ€§ | æ¶ˆè´¹ç«¯ä¿è¯é‡å¤æ¶ˆè´¹ä¸ä¼šäº§ç”Ÿé‡å¤è®¢å• |

---

## 7ï¸âƒ£ å®Œæ•´ä»£ç å®ç°

### 7.1 é¡¹ç›®ç»“æ„

```
seckill-system/
â”œâ”€â”€ src/main/java/com/seckill/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ SeckillController.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ SeckillService.java
â”‚   â”‚   â”œâ”€â”€ OrderService.java
â”‚   â”‚   â””â”€â”€ ProductService.java
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ RedisConfig.java
â”‚   â”‚   â””â”€â”€ RabbitMQConfig.java
â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ SeckillOrder.java
â”‚   â”‚   â””â”€â”€ SeckillProduct.java
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â””â”€â”€ SeckillMessage.java
â”‚   â”œâ”€â”€ consumer/
â”‚   â”‚   â””â”€â”€ SeckillConsumer.java
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ RedisLuaScript.java
```

### 7.2 å®ä½“ç±»å®šä¹‰

```java
// ç§’æ€å•†å“å®ä½“
@Data
@Entity
@Table(name = "seckill_product")
public class SeckillProduct {
    @Id
    private Long id;
    
    private String name;
    
    private BigDecimal price;
    
    private Integer stock;
    
    private LocalDateTime startTime;
    
    private LocalDateTime endTime;
    
    private Integer status; // 0-æœªå¼€å§‹ 1-è¿›è¡Œä¸­ 2-å·²ç»“æŸ
}

// ç§’æ€è®¢å•å®ä½“
@Data
@Entity
@Table(name = "seckill_order")
public class SeckillOrder {
    @Id
    private String id;
    
    private Long userId;
    
    private Long productId;
    
    private BigDecimal price;
    
    private Integer status; // 0-å¾…æ”¯ä»˜ 1-å·²æ”¯ä»˜ 2-å·²å–æ¶ˆ
    
    private LocalDateTime createTime;
    
    private LocalDateTime payTime;
}
```

### 7.3 Redisé…ç½®å’ŒLuaè„šæœ¬

```java
@Configuration
public class RedisConfig {
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // è®¾ç½®åºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> serializer = new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper mapper = new ObjectMapper();
        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        mapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);
        serializer.setObjectMapper(mapper);
        
        template.setValueSerializer(serializer);
        template.setKeySerializer(new StringRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(serializer);
        
        template.afterPropertiesSet();
        return template;
    }
}

// Luaè„šæœ¬å·¥å…·ç±»
@Component
public class RedisLuaScript {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // åº“å­˜é¢„æ‰£Luaè„šæœ¬
    private static final String STOCK_DECR_SCRIPT = 
        "local stock = redis.call('get', KEYS[1]) " +
        "if stock == false or tonumber(stock) <= 0 then " +
        "    return -1 " +
        "end " +
        "local newStock = redis.call('decr', KEYS[1]) " +
        "if newStock < 0 then " +
        "    redis.call('incr', KEYS[1]) " +
        "    return -1 " +
        "end " +
        "return newStock";
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ä¸‹å•
    private static final String CHECK_USER_ORDER_SCRIPT = 
        "local exists = redis.call('exists', KEYS[1]) " +
        "if exists == 1 then " +
        "    return 1 " +
        "end " +
        "redis.call('setex', KEYS[1], ARGV[1], '1') " +
        "return 0";
    
    /**
     * åŸå­æ€§æ‰£å‡åº“å­˜
     */
    public Long decrStock(String stockKey) {
        DefaultRedisScript<Long> script = new DefaultRedisScript<>();
        script.setScriptText(STOCK_DECR_SCRIPT);
        script.setResultType(Long.class);
        
        return redisTemplate.execute(script, Collections.singletonList(stockKey));
    }
    
    /**
     * æ£€æŸ¥å¹¶æ ‡è®°ç”¨æˆ·å·²ä¸‹å•
     */
    public Boolean checkAndSetUserOrder(String userOrderKey, int expireSeconds) {
        DefaultRedisScript<Long> script = new DefaultRedisScript<>();
        script.setScriptText(CHECK_USER_ORDER_SCRIPT);
        script.setResultType(Long.class);
        
        Long result = redisTemplate.execute(script, 
            Collections.singletonList(userOrderKey), 
            String.valueOf(expireSeconds));
        
        return result != null && result == 0; // 0è¡¨ç¤ºæˆåŠŸè®¾ç½®ï¼Œ1è¡¨ç¤ºå·²å­˜åœ¨
    }
}
```

### 7.4 æ¶ˆæ¯é˜Ÿåˆ—é…ç½®

```java
@Configuration
public class RabbitMQConfig {
    
    // ç§’æ€æ¶ˆæ¯é˜Ÿåˆ—
    public static final String SECKILL_QUEUE = "seckill.queue";
    public static final String SECKILL_EXCHANGE = "seckill.exchange";
    public static final String SECKILL_ROUTING_KEY = "seckill.message";
    
    @Bean
    public Queue seckillQueue() {
        return QueueBuilder.durable(SECKILL_QUEUE).build();
    }
    
    @Bean
    public DirectExchange seckillExchange() {
        return new DirectExchange(SECKILL_EXCHANGE);
    }
    
    @Bean
    public Binding seckillBinding() {
        return BindingBuilder
            .bind(seckillQueue())
            .to(seckillExchange())
            .with(SECKILL_ROUTING_KEY);
    }
    
    @Bean
    public MessageConverter messageConverter() {
        return new Jackson2JsonMessageConverter();
    }
}

// ç§’æ€æ¶ˆæ¯DTO
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SeckillMessage {
    private Long userId;
    private Long productId;
    private String orderId;
    private LocalDateTime createTime;
}
```

### 7.5 ç§’æ€æ§åˆ¶å™¨

```java
@RestController
@RequestMapping("/seckill")
@Slf4j
public class SeckillController {
    
    @Autowired
    private SeckillService seckillService;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * ç§’æ€æ¥å£
     */
    @PostMapping("/{productId}")
    public Result<String> seckill(@PathVariable Long productId, 
                                 @RequestParam Long userId) {
        try {
            // 1. å‚æ•°æ ¡éªŒ
            if (productId == null || userId == null) {
                return Result.fail("å‚æ•°ä¸èƒ½ä¸ºç©º");
            }
            
            // 2. æ£€æŸ¥ç§’æ€æ´»åŠ¨çŠ¶æ€
            if (!seckillService.isSeckillActive(productId)) {
                return Result.fail("ç§’æ€æ´»åŠ¨æœªå¼€å§‹æˆ–å·²ç»“æŸ");
            }
            
            // 3. æ‰§è¡Œç§’æ€
            String orderId = seckillService.executeSeckill(productId, userId);
            
            if (orderId != null) {
                return Result.success("æ’é˜ŸæˆåŠŸï¼Œè®¢å•å·ï¼š" + orderId);
            } else {
                return Result.fail("ç§’æ€å¤±è´¥ï¼Œè¯·é‡è¯•");
            }
            
        } catch (Exception e) {
            log.error("ç§’æ€å¼‚å¸¸ï¼Œå•†å“IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", productId, userId, e);
            return Result.fail("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
        }
    }
    
    /**
     * æŸ¥è¯¢ç§’æ€ç»“æœ
     */
    @GetMapping("/result/{orderId}")
    public Result<SeckillOrder> getSeckillResult(@PathVariable String orderId) {
        try {
            SeckillOrder order = seckillService.getSeckillOrder(orderId);
            if (order != null) {
                return Result.success(order);
            } else {
                return Result.fail("è®¢å•ä¸å­˜åœ¨æˆ–å¤„ç†ä¸­");
            }
        } catch (Exception e) {
            log.error("æŸ¥è¯¢ç§’æ€ç»“æœå¼‚å¸¸ï¼Œè®¢å•IDï¼š{}", orderId, e);
            return Result.fail("æŸ¥è¯¢å¤±è´¥");
        }
    }
    
    /**
     * è·å–å•†å“åº“å­˜
     */
    @GetMapping("/stock/{productId}")
    public Result<Integer> getStock(@PathVariable Long productId) {
        try {
            String stockKey = "stock:" + productId;
            Object stock = redisTemplate.opsForValue().get(stockKey);
            if (stock != null) {
                return Result.success(Integer.valueOf(stock.toString()));
            } else {
                return Result.success(0);
            }
        } catch (Exception e) {
            log.error("è·å–åº“å­˜å¼‚å¸¸ï¼Œå•†å“IDï¼š{}", productId, e);
            return Result.fail("è·å–åº“å­˜å¤±è´¥");
        }
    }
}
```

### 7.6 ç§’æ€æœåŠ¡å®ç°

```java
@Service
@Slf4j
public class SeckillService {
    
    @Autowired
    private ProductService productService;
    
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private RedisLuaScript redisLuaScript;
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String STOCK_PREFIX = "stock:";
    private static final String USER_ORDER_PREFIX = "user_order:";
    private static final int USER_ORDER_EXPIRE = 3600; // 1å°æ—¶
    
    /**
     * æ£€æŸ¥ç§’æ€æ´»åŠ¨æ˜¯å¦è¿›è¡Œä¸­
     */
    public boolean isSeckillActive(Long productId) {
        try {
            SeckillProduct product = productService.getById(productId);
            if (product == null) {
                return false;
            }
            
            LocalDateTime now = LocalDateTime.now();
            return product.getStatus() == 1 && 
                   now.isAfter(product.getStartTime()) && 
                   now.isBefore(product.getEndTime());
        } catch (Exception e) {
            log.error("æ£€æŸ¥ç§’æ€æ´»åŠ¨çŠ¶æ€å¼‚å¸¸ï¼Œå•†å“IDï¼š{}", productId, e);
            return false;
        }
    }
    
    /**
     * æ‰§è¡Œç§’æ€
     */
    public String executeSeckill(Long productId, Long userId) {
        try {
            // 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ä¸‹å•
            String userOrderKey = USER_ORDER_PREFIX + userId + ":" + productId;
            if (!redisLuaScript.checkAndSetUserOrder(userOrderKey, USER_ORDER_EXPIRE)) {
                log.warn("ç”¨æˆ·å·²ä¸‹å•ï¼Œç”¨æˆ·IDï¼š{}ï¼Œå•†å“IDï¼š{}", userId, productId);
                return null;
            }
            
            // 2. åŸå­æ€§æ‰£å‡åº“å­˜
            String stockKey = STOCK_PREFIX + productId;
            Long remainingStock = redisLuaScript.decrStock(stockKey);
            
            if (remainingStock == null || remainingStock < 0) {
                log.warn("åº“å­˜ä¸è¶³ï¼Œå•†å“IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", productId, userId);
                return null;
            }
            
            // 3. ç”Ÿæˆè®¢å•ID
            String orderId = generateOrderId();
            
            // 4. å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—
            SeckillMessage message = new SeckillMessage();
            message.setUserId(userId);
            message.setProductId(productId);
            message.setOrderId(orderId);
            message.setCreateTime(LocalDateTime.now());
            
            rabbitTemplate.convertAndSend(
                RabbitMQConfig.SECKILL_EXCHANGE,
                RabbitMQConfig.SECKILL_ROUTING_KEY,
                message
            );
            
            log.info("ç§’æ€è¯·æ±‚å·²å…¥é˜Ÿï¼Œè®¢å•IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}ï¼Œå•†å“IDï¼š{}", orderId, userId, productId);
            return orderId;
            
        } catch (Exception e) {
            log.error("æ‰§è¡Œç§’æ€å¼‚å¸¸ï¼Œå•†å“IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", productId, userId, e);
            return null;
        }
    }
    
    /**
     * è·å–ç§’æ€è®¢å•
     */
    public SeckillOrder getSeckillOrder(String orderId) {
        try {
            return orderService.getByOrderId(orderId);
        } catch (Exception e) {
            log.error("è·å–ç§’æ€è®¢å•å¼‚å¸¸ï¼Œè®¢å•IDï¼š{}", orderId, e);
            return null;
        }
    }
    
    /**
     * é¢„çƒ­å•†å“åº“å­˜åˆ°Redis
     */
    public void warmUpStock(Long productId) {
        try {
            SeckillProduct product = productService.getById(productId);
            if (product != null && product.getStock() > 0) {
                String stockKey = STOCK_PREFIX + productId;
                redisTemplate.opsForValue().set(stockKey, product.getStock());
                log.info("å•†å“åº“å­˜é¢„çƒ­æˆåŠŸï¼Œå•†å“IDï¼š{}ï¼Œåº“å­˜ï¼š{}", productId, product.getStock());
            }
        } catch (Exception e) {
            log.error("é¢„çƒ­å•†å“åº“å­˜å¼‚å¸¸ï¼Œå•†å“IDï¼š{}", productId, e);
        }
    }
    
    /**
     * ç”Ÿæˆè®¢å•ID
     */
    private String generateOrderId() {
        return "SK" + System.currentTimeMillis() + ThreadLocalRandom.current().nextInt(1000, 9999);
    }
}
```

### 7.7 æ¶ˆæ¯æ¶ˆè´¹è€…

```java
@Component
@Slf4j
public class SeckillConsumer {
    
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private ProductService productService;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æ¶ˆè´¹ç§’æ€æ¶ˆæ¯
     */
    @RabbitListener(queues = RabbitMQConfig.SECKILL_QUEUE)
    public void handleSeckillMessage(SeckillMessage message) {
        log.info("å¼€å§‹å¤„ç†ç§’æ€æ¶ˆæ¯ï¼Œè®¢å•IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}ï¼Œå•†å“IDï¼š{}", 
                message.getOrderId(), message.getUserId(), message.getProductId());
        
        try {
            // 1. å†æ¬¡æ£€æŸ¥åº“å­˜ï¼ˆåŒé‡ä¿é™©ï¼‰
            SeckillProduct product = productService.getById(message.getProductId());
            if (product == null || product.getStock() <= 0) {
                log.warn("å•†å“ä¸å­˜åœ¨æˆ–åº“å­˜ä¸è¶³ï¼Œè®¢å•IDï¼š{}", message.getOrderId());
                return;
            }
            
            // 2. åˆ›å»ºè®¢å•
            SeckillOrder order = new SeckillOrder();
            order.setId(message.getOrderId());
            order.setUserId(message.getUserId());
            order.setProductId(message.getProductId());
            order.setPrice(product.getPrice());
            order.setStatus(0); // å¾…æ”¯ä»˜
            order.setCreateTime(LocalDateTime.now());
            
            // 3. æ‰£å‡æ•°æ®åº“åº“å­˜
            boolean stockUpdated = productService.decrStock(message.getProductId());
            if (!stockUpdated) {
                log.warn("æ‰£å‡æ•°æ®åº“åº“å­˜å¤±è´¥ï¼Œè®¢å•IDï¼š{}", message.getOrderId());
                return;
            }
            
            // 4. ä¿å­˜è®¢å•
            orderService.save(order);
            
            log.info("ç§’æ€è®¢å•åˆ›å»ºæˆåŠŸï¼Œè®¢å•IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}ï¼Œå•†å“IDï¼š{}", 
                    message.getOrderId(), message.getUserId(), message.getProductId());
            
        } catch (Exception e) {
            log.error("å¤„ç†ç§’æ€æ¶ˆæ¯å¼‚å¸¸ï¼Œè®¢å•IDï¼š{}", message.getOrderId(), e);
        }
    }
}
```

### 7.8 å•†å“æœåŠ¡

```java
@Service
@Transactional
public class ProductService {
    
    @Autowired
    private SeckillProductMapper productMapper;
    
    /**
     * æ‰£å‡æ•°æ®åº“åº“å­˜
     */
    public boolean decrStock(Long productId) {
        try {
            int result = productMapper.decrStock(productId);
            return result > 0;
        } catch (Exception e) {
            log.error("æ‰£å‡æ•°æ®åº“åº“å­˜å¼‚å¸¸ï¼Œå•†å“IDï¼š{}", productId, e);
            return false;
        }
    }
    
    /**
     * è·å–å•†å“ä¿¡æ¯
     */
    public SeckillProduct getById(Long productId) {
        try {
            return productMapper.selectById(productId);
        } catch (Exception e) {
            log.error("è·å–å•†å“ä¿¡æ¯å¼‚å¸¸ï¼Œå•†å“IDï¼š{}", productId, e);
            return null;
        }
    }
}
```

### 7.9 è®¢å•æœåŠ¡

```java
@Service
public class OrderService {
    
    @Autowired
    private SeckillOrderMapper orderMapper;
    
    /**
     * ä¿å­˜è®¢å•
     */
    public void save(SeckillOrder order) {
        try {
            orderMapper.insert(order);
        } catch (Exception e) {
            log.error("ä¿å­˜è®¢å•å¼‚å¸¸ï¼Œè®¢å•IDï¼š{}", order.getId(), e);
            throw new RuntimeException("ä¿å­˜è®¢å•å¤±è´¥", e);
        }
    }
    
    /**
     * æ ¹æ®è®¢å•IDæŸ¥è¯¢è®¢å•
     */
    public SeckillOrder getByOrderId(String orderId) {
        try {
            return orderMapper.selectByOrderId(orderId);
        } catch (Exception e) {
            log.error("æŸ¥è¯¢è®¢å•å¼‚å¸¸ï¼Œè®¢å•IDï¼š{}", orderId, e);
            return null;
        }
    }
}
```

### 7.10 æ•°æ®åº“Mapper

```java
// å•†å“Mapper
@Mapper
public interface SeckillProductMapper extends BaseMapper<SeckillProduct> {
    
    /**
     * æ‰£å‡åº“å­˜
     */
    @Update("UPDATE seckill_product SET stock = stock - 1 WHERE id = #{productId} AND stock > 0")
    int decrStock(@Param("productId") Long productId);
}

// è®¢å•Mapper
@Mapper
public interface SeckillOrderMapper extends BaseMapper<SeckillOrder> {
    
    /**
     * æ ¹æ®è®¢å•IDæŸ¥è¯¢
     */
    @Select("SELECT * FROM seckill_order WHERE id = #{orderId}")
    SeckillOrder selectByOrderId(@Param("orderId") String orderId);
}
```

---

## 8ï¸âƒ£ å¼‚æ­¥ç§’æ€ä¼˜åŒ–æŠ€å·§

### 8.1 æœ¬åœ°ç¼“å­˜åº“å­˜

```java
@Component
public class LocalStockCache {
    
    private final Map<Long, AtomicInteger> localStockMap = new ConcurrentHashMap<>();
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * è·å–æœ¬åœ°åº“å­˜
     */
    public int getLocalStock(Long productId) {
        AtomicInteger stock = localStockMap.get(productId);
        return stock != null ? stock.get() : 0;
    }
    
    /**
     * æ‰£å‡æœ¬åœ°åº“å­˜
     */
    public boolean decrLocalStock(Long productId) {
        AtomicInteger stock = localStockMap.computeIfAbsent(productId, k -> new AtomicInteger(0));
        return stock.decrementAndGet() >= 0;
    }
    
    /**
     * åŒæ­¥Redisåº“å­˜åˆ°æœ¬åœ°
     */
    @Scheduled(fixedRate = 1000) // æ¯ç§’åŒæ­¥ä¸€æ¬¡
    public void syncStockFromRedis() {
        for (Long productId : localStockMap.keySet()) {
            String stockKey = "stock:" + productId;
            Object redisStock = redisTemplate.opsForValue().get(stockKey);
            if (redisStock != null) {
                int stock = Integer.parseInt(redisStock.toString());
                localStockMap.put(productId, new AtomicInteger(stock));
            }
        }
    }
}
```

### 8.2 é™æµé…ç½®

```java
@Configuration
public class RateLimitConfig {
    
    @Bean
    public RedisRateLimiter redisRateLimiter() {
        return new RedisRateLimiter(100, 200); // æ¯ç§’100ä¸ªè¯·æ±‚ï¼Œçªå‘200ä¸ª
    }
}

// é™æµæ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RateLimit {
    String key() default "rate_limit";
    int time() default 60;
    int count() default 100;
}

// é™æµåˆ‡é¢
@Aspect
@Component
public class RateLimitAspect {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Around("@annotation(rateLimit)")
    public Object around(ProceedingJoinPoint point, RateLimit rateLimit) throws Throwable {
        String key = rateLimit.key();
        int time = rateLimit.time();
        int count = rateLimit.count();
        
        String rateLimitKey = "rate_limit:" + key + ":" + System.currentTimeMillis() / 1000;
        
        Long current = redisTemplate.opsForValue().increment(rateLimitKey);
        if (current == 1) {
            redisTemplate.expire(rateLimitKey, time, TimeUnit.SECONDS);
        }
        
        if (current > count) {
            throw new RuntimeException("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        return point.proceed();
    }
}
```

### 8.3 çƒ­ç‚¹å•†å“é¢„çƒ­

```java
@Component
public class HotProductPreheater {
    
    @Autowired
    private SeckillService seckillService;
    
    @Autowired
    private ProductService productService;
    
    /**
     * é¢„çƒ­çƒ­ç‚¹å•†å“
     */
    @Scheduled(cron = "0 0 0 * * ?") // æ¯å¤©å‡Œæ™¨æ‰§è¡Œ
    public void preheatHotProducts() {
        List<SeckillProduct> hotProducts = productService.getHotProducts();
        
        for (SeckillProduct product : hotProducts) {
            seckillService.warmUpStock(product.getId());
        }
        
        log.info("çƒ­ç‚¹å•†å“é¢„çƒ­å®Œæˆï¼Œé¢„çƒ­å•†å“æ•°é‡ï¼š{}", hotProducts.size());
    }
}
```

---

## 9ï¸âƒ£ ç›‘æ§å’Œå‘Šè­¦

```java
@Component
public class SeckillMonitor {
    
    @Autowired
    private MeterRegistry meterRegistry;
    
    private final Counter successCounter = Counter.builder("seckill.success").register(meterRegistry);
    private final Counter failCounter = Counter.builder("seckill.fail").register(meterRegistry);
    private final Timer processTimer = Timer.builder("seckill.process.time").register(meterRegistry);
    
    /**
     * è®°å½•ç§’æ€æˆåŠŸ
     */
    public void recordSuccess() {
        successCounter.increment();
    }
    
    /**
     * è®°å½•ç§’æ€å¤±è´¥
     */
    public void recordFail() {
        failCounter.increment();
    }
    
    /**
     * è®°å½•å¤„ç†æ—¶é—´
     */
    public void recordProcessTime(Duration duration) {
        processTimer.record(duration);
    }
}
```

---

## ğŸ”Ÿ å‰ç«¯å®ç°ç¤ºä¾‹

### 10.1 Vue.js å‰ç«¯å®ç°

```vue
<template>
  <div class="seckill-container">
    <div class="product-info">
      <h2>{{ product.name }}</h2>
      <p>ä»·æ ¼ï¼šÂ¥{{ product.price }}</p>
      <p>åº“å­˜ï¼š{{ stock }}</p>
    </div>
    
    <div class="seckill-button">
      <button 
        v-if="!isSeckilling && stock > 0" 
        @click="startSeckill"
        :disabled="isSeckilling"
      >
        ç«‹å³ç§’æ€
      </button>
      <button v-else-if="isSeckilling" disabled>
        æ’é˜Ÿä¸­...
      </button>
      <button v-else disabled>
        å·²å”®ç½„
      </button>
    </div>
    
    <div v-if="orderResult" class="result">
      <p v-if="orderResult.success">ç§’æ€æˆåŠŸï¼è®¢å•å·ï¼š{{ orderResult.orderId }}</p>
      <p v-else>{{ orderResult.message }}</p>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      product: {},
      stock: 0,
      isSeckilling: false,
      orderResult: null,
      pollTimer: null
    }
  },
  
  mounted() {
    this.loadProductInfo();
    this.startStockPolling();
  },
  
  beforeDestroy() {
    if (this.pollTimer) {
      clearInterval(this.pollTimer);
    }
  },
  
  methods: {
    async loadProductInfo() {
      try {
        const response = await this.$http.get(`/api/product/${this.$route.params.productId}`);
        this.product = response.data;
      } catch (error) {
        console.error('åŠ è½½å•†å“ä¿¡æ¯å¤±è´¥', error);
      }
    },
    
    async getStock() {
      try {
        const response = await this.$http.get(`/api/seckill/stock/${this.$route.params.productId}`);
        this.stock = response.data;
      } catch (error) {
        console.error('è·å–åº“å­˜å¤±è´¥', error);
      }
    },
    
    startStockPolling() {
      this.getStock();
      this.pollTimer = setInterval(() => {
        this.getStock();
      }, 1000);
    },
    
    async startSeckill() {
      this.isSeckilling = true;
      this.orderResult = null;
      
      try {
        const response = await this.$http.post(`/api/seckill/${this.$route.params.productId}`, {
          userId: this.getCurrentUserId()
        });
        
        if (response.data.success) {
          this.orderResult = {
            success: true,
            orderId: response.data.data
          };
          this.pollOrderResult(response.data.data);
        } else {
          this.orderResult = {
            success: false,
            message: response.data.message
          };
        }
      } catch (error) {
        this.orderResult = {
          success: false,
          message: 'ç½‘ç»œå¼‚å¸¸ï¼Œè¯·é‡è¯•'
        };
      } finally {
        this.isSeckilling = false;
      }
    },
    
    async pollOrderResult(orderId) {
      const maxAttempts = 30; // æœ€å¤šè½®è¯¢30æ¬¡
      let attempts = 0;
      
      const poll = async () => {
        try {
          const response = await this.$http.get(`/api/seckill/result/${orderId}`);
          
          if (response.data.success) {
            this.orderResult = {
              success: true,
              orderId: orderId,
              order: response.data.data
            };
            return;
          }
          
          attempts++;
          if (attempts < maxAttempts) {
            setTimeout(poll, 1000); // 1ç§’åé‡è¯•
          } else {
            this.orderResult = {
              success: false,
              message: 'è®¢å•å¤„ç†è¶…æ—¶ï¼Œè¯·ç¨åæŸ¥è¯¢'
            };
          }
        } catch (error) {
          console.error('æŸ¥è¯¢è®¢å•ç»“æœå¤±è´¥', error);
          attempts++;
          if (attempts < maxAttempts) {
            setTimeout(poll, 1000);
          }
        }
      };
      
      poll();
    },
    
    getCurrentUserId() {
      // è·å–å½“å‰ç”¨æˆ·IDçš„é€»è¾‘
      return localStorage.getItem('userId') || '1';
    }
  }
}
</script>
```

---

## 1ï¸âƒ£1ï¸âƒ£ æ€»ç»“ä¸ç›´è§‚æ¯”å–»

### æ ¸å¿ƒæµç¨‹æ€»ç»“ï¼š

1. **å‰ç«¯**ï¼šæ‹¿åˆ°"æŠ¢è´­å‡­è¯"ï¼Œæ— éœ€ç›´æ¥ç­‰å¾…æ•°æ®åº“å®Œæˆè®¢å•
2. **æ¥å£å±‚**ï¼šå¿«é€Ÿåˆ¤æ–­åº“å­˜å’Œç”¨æˆ·èµ„æ ¼ï¼Œå…¥é˜Ÿ â†’ é«˜å¹¶å‘ä¸‹çº¿ç¨‹ä¸è¢«é˜»å¡
3. **åå°**ï¼šæ¶ˆè´¹é˜Ÿåˆ— â†’ æ‰£æ•°æ®åº“åº“å­˜ â†’ åˆ›å»ºè®¢å• â†’ é€šçŸ¥ç”¨æˆ·
4. **Redis + æ¶ˆæ¯é˜Ÿåˆ—**ï¼šä¿è¯åº“å­˜åŸå­æ€§ã€é¡ºåºå¤„ç†ã€ç³»ç»Ÿå¹³ç¨³è¿è¡Œ

### âš¡ å¼‚æ­¥ç§’æ€çš„æ ¸å¿ƒç†å¿µï¼š

**å¿«é€Ÿæ¥æ”¶è¯·æ±‚ + æ’é˜Ÿ + å¼‚æ­¥å¤„ç†**ï¼Œå®ç°å‰Šå³°å¡«è°·ã€é˜²æ­¢è¶…å–ã€æå‡ç³»ç»Ÿååé‡ã€‚

### ğŸ’¡ ç›´è§‚ç±»æ¯”ï¼š

- **å‰ç«¯ç”¨æˆ·**ï¼šæ‹¿åˆ°å–é¤å·
- **åå°ç³»ç»Ÿ**ï¼šå¨æˆ¿æŒ‰é¡ºåºåšèœ
- **ç”¨æˆ·æœ€ç»ˆèƒ½æ‹¿åˆ°èœï¼Œä½†ç³»ç»Ÿä¸ä¼šè¢«ç¬æ—¶æµé‡å‹å®**

### æŠ€æœ¯ä¼˜åŠ¿ï¼š

1. **é«˜å¹¶å‘å¤„ç†**ï¼šRedis + æ¶ˆæ¯é˜Ÿåˆ—å®ç°å‰Šå³°å¡«è°·
2. **é˜²æ­¢è¶…å–**ï¼šLuaè„šæœ¬ä¿è¯åŸå­æ€§æ“ä½œ
3. **ç³»ç»Ÿç¨³å®š**ï¼šå¼‚æ­¥å¤„ç†é¿å…æ•°æ®åº“å‹åŠ›
4. **ç”¨æˆ·ä½“éªŒ**ï¼šå¿«é€Ÿå“åº”ï¼Œæ— éœ€é•¿æ—¶é—´ç­‰å¾…
5. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²å’Œæ°´å¹³æ‰©å±•

é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†åˆ†æå’Œå®Œæ•´ä»£ç å®ç°ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹å¼‚æ­¥ç§’æ€ç³»ç»Ÿæœ‰äº†æ·±å…¥çš„ç†è§£ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚å¯¹ä»£ç è¿›è¡Œç›¸åº”çš„è°ƒæ•´å’Œä¼˜åŒ–ã€‚

---

*æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¼‚æ­¥ç§’æ€ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ï¼ŒåŒ…å«äº†å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œä¼˜åŒ–æŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„ç§’æ€ç³»ç»Ÿã€‚*
