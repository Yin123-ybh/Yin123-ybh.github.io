---
title: "秒杀活动功能完善指南 - 第二部分"
date: 2025-01-12
draft: false
tags: ["Java", "Spring Boot", "Redis", "高并发", "秒杀系统"]
categories: ["Web开发"]
description: "详细介绍如何从零开始构建一个高并发的秒杀活动系统，包括防超卖、分布式锁、Redis缓存等核心技术实现。"
---
# 秒杀活动功能完善指南 - 第二部分

## 目录
1. [前端界面开发](#前端界面开发)
2. [微信小程序集成](#微信小程序集成)
3. [测试和优化](#测试和优化)
4. [GitHub Pages 部署指南](#github-pages-部署指南)

---

## 前端界面开发

### 1. 创建秒杀活动API

```javascript
// 文件路径: src/api/seckill.js
import request from '@/utils/request'

export const seckillApi = {
  // 获取当前进行中的秒杀活动
  getCurrentActivities() {
    return request({
      url: '/user/seckill/activity/current',
      method: 'get'
    })
  },
  
  // 获取秒杀活动详情
  getActivityDetail(id) {
    return request({
      url: `/user/seckill/activity/${id}`,
      method: 'get'
    })
  },
  
  // 参与秒杀活动
  participateSeckill(id, quantity) {
    return request({
      url: `/user/seckill/activity/participate/${id}`,
      method: 'post',
      params: { quantity }
    })
  }
}
```

### 2. 创建秒杀活动页面

```vue
<!-- 文件路径: src/views/seckill/index.vue -->
<template>
  <div class="seckill-container">
    <div class="seckill-header">
      <h2>限时秒杀</h2>
      <p>抢购火爆商品，限时特价</p>
    </div>
    
    <div class="seckill-content">
      <div v-for="activity in activities" :key="activity.id" class="seckill-item">
        <div class="product-info">
          <img :src="activity.dishImage" :alt="activity.dishName" class="product-image">
          <div class="product-details">
            <h3>{{ activity.dishName }}</h3>
            <p class="product-desc">{{ activity.description }}</p>
            <div class="price-info">
              <span class="original-price">¥{{ activity.originalPrice }}</span>
              <span class="seckill-price">¥{{ activity.seckillPrice }}</span>
            </div>
          </div>
        </div>
        
        <div class="seckill-info">
          <div class="stock-info">
            <span>库存：{{ activity.stock - activity.soldCount }}/{{ activity.stock }}</span>
            <div class="progress-bar">
              <div class="progress" :style="{ width: getStockPercent(activity) + '%' }"></div>
            </div>
          </div>
          
          <div class="time-info">
            <div v-if="getActivityStatus(activity) === 'not-started'" class="countdown">
              <span>距离开始：</span>
              <countdown :end-time="activity.startTime" @finish="onCountdownFinish" />
            </div>
            <div v-else-if="getActivityStatus(activity) === 'ended'" class="ended">
              活动已结束
            </div>
            <div v-else class="countdown">
              <span>距离结束：</span>
              <countdown :end-time="activity.endTime" @finish="onCountdownFinish" />
            </div>
          </div>
          
          <div class="action-area">
            <el-button 
              v-if="getActivityStatus(activity) === 'active'"
              type="danger" 
              size="large"
              :disabled="!canParticipate(activity)"
              @click="participateSeckill(activity)"
            >
              立即抢购
            </el-button>
            <el-button v-else disabled size="large">
              {{ getButtonText(activity) }}
            </el-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { seckillApi } from '@/api/seckill'
import Countdown from '@/components/Countdown'

export default {
  name: 'SeckillActivity',
  components: { Countdown },
  data() {
    return {
      activities: [],
      loading: false
    }
  },
  created() {
    this.getCurrentActivities()
  },
  methods: {
    async getCurrentActivities() {
      this.loading = true
      try {
        const response = await seckillApi.getCurrentActivities()
        if (response.data.code === 1) {
          this.activities = response.data.data
        }
      } catch (error) {
        console.error('获取秒杀活动失败', error)
      } finally {
        this.loading = false
      }
    },
    
    async participateSeckill(activity) {
      try {
        const response = await seckillApi.participateSeckill(activity.id, 1)
        if (response.data.code === 1) {
          this.$message.success(response.data.data)
          this.getCurrentActivities() // 刷新列表
        } else {
          this.$message.error(response.data.msg)
        }
      } catch (error) {
        console.error('参与秒杀失败', error)
        this.$message.error('参与失败，请重试')
      }
    },
    
    getActivityStatus(activity) {
      const now = new Date()
      const startTime = new Date(activity.startTime)
      const endTime = new Date(activity.endTime)
      
      if (now < startTime) return 'not-started'
      if (now > endTime) return 'ended'
      return 'active'
    },
    
    getStockPercent(activity) {
      return ((activity.stock - activity.soldCount) / activity.stock) * 100
    },
    
    canParticipate(activity) {
      return activity.stock > activity.soldCount && activity.status === 1
    },
    
    getButtonText(activity) {
      const status = this.getActivityStatus(activity)
      switch (status) {
        case 'not-started': return '未开始'
        case 'ended': return '已结束'
        default: return '立即抢购'
      }
    },
    
    onCountdownFinish() {
      this.getCurrentActivities()
    }
  }
}
</script>

<style scoped>
.seckill-container {
  padding: 20px;
}

.seckill-header {
  text-align: center;
  margin-bottom: 30px;
}

.seckill-header h2 {
  color: #f56c6c;
  font-size: 28px;
  margin-bottom: 10px;
}

.seckill-content {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  gap: 20px;
}

.seckill-item {
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  padding: 20px;
  background: #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.product-info {
  display: flex;
  margin-bottom: 15px;
}

.product-image {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 4px;
  margin-right: 15px;
}

.product-details h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  color: #303133;
}

.product-desc {
  color: #909399;
  font-size: 12px;
  margin: 0 0 10px 0;
}

.price-info {
  display: flex;
  align-items: center;
  gap: 10px;
}

.original-price {
  text-decoration: line-through;
  color: #909399;
  font-size: 14px;
}

.seckill-price {
  color: #f56c6c;
  font-size: 18px;
  font-weight: bold;
}

.seckill-info {
  border-top: 1px solid #f0f0f0;
  padding-top: 15px;
}

.stock-info {
  margin-bottom: 10px;
}

.progress-bar {
  width: 100%;
  height: 6px;
  background: #f0f0f0;
  border-radius: 3px;
  overflow: hidden;
  margin-top: 5px;
}

.progress {
  height: 100%;
  background: linear-gradient(90deg, #f56c6c, #ff9a9a);
  transition: width 0.3s ease;
}

.time-info {
  margin-bottom: 15px;
  text-align: center;
}

.countdown {
  color: #f56c6c;
  font-weight: bold;
}

.ended {
  color: #909399;
}

.action-area {
  text-align: center;
}

.action-area .el-button {
  width: 100%;
}
</style>
```

### 3. 创建倒计时组件

```vue
<!-- 文件路径: src/components/Countdown.vue -->
<template>
  <span class="countdown">
    {{ formattedTime }}
  </span>
</template>

<script>
export default {
  name: 'Countdown',
  props: {
    endTime: {
      type: String,
      required: true
    }
  },
  data() {
    return {
      timeLeft: 0,
      timer: null
    }
  },
  computed: {
    formattedTime() {
      const hours = Math.floor(this.timeLeft / 3600)
      const minutes = Math.floor((this.timeLeft % 3600) / 60)
      const seconds = this.timeLeft % 60
      
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
    }
  },
  mounted() {
    this.startCountdown()
  },
  beforeDestroy() {
    this.clearTimer()
  },
  methods: {
    startCountdown() {
      this.updateTimeLeft()
      this.timer = setInterval(() => {
        this.updateTimeLeft()
      }, 1000)
    },
    
    updateTimeLeft() {
      const now = new Date().getTime()
      const end = new Date(this.endTime).getTime()
      this.timeLeft = Math.max(0, Math.floor((end - now) / 1000))
      
      if (this.timeLeft <= 0) {
        this.clearTimer()
        this.$emit('finish')
      }
    },
    
    clearTimer() {
      if (this.timer) {
        clearInterval(this.timer)
        this.timer = null
      }
    }
  }
}
</script>

<style scoped>
.countdown {
  font-family: 'Courier New', monospace;
  font-weight: bold;
  color: #f56c6c;
}
</style>
```

---

## 微信小程序集成

### 1. 创建秒杀活动页面

```vue
<!-- 文件路径: pages/seckill/index.vue -->
<template>
  <view class="seckill-container">
    <view class="seckill-header">
      <text class="title">限时秒杀</text>
      <text class="subtitle">抢购火爆商品，限时特价</text>
    </view>
    
    <view class="seckill-list">
      <view v-for="activity in activities" :key="activity.id" class="seckill-item">
        <image :src="activity.dishImage" class="product-image" />
        <view class="product-info">
          <text class="product-name">{{ activity.dishName }}</text>
          <text class="product-desc">{{ activity.description }}</text>
          <view class="price-info">
            <text class="original-price">¥{{ activity.originalPrice }}</text>
            <text class="seckill-price">¥{{ activity.seckillPrice }}</text>
          </view>
        </view>
        
        <view class="seckill-action">
          <view class="stock-info">
            <text class="stock-text">库存：{{ activity.stock - activity.soldCount }}/{{ activity.stock }}</text>
            <view class="progress-bar">
              <view class="progress" :style="{ width: getStockPercent(activity) + '%' }"></view>
            </view>
          </view>
          
          <view class="time-info">
            <text v-if="getActivityStatus(activity) === 'not-started'" class="countdown">
              距离开始：{{ getCountdown(activity.startTime) }}
            </text>
            <text v-else-if="getActivityStatus(activity) === 'ended'" class="ended">
              活动已结束
            </text>
            <text v-else class="countdown">
              距离结束：{{ getCountdown(activity.endTime) }}
            </text>
          </view>
          
          <button 
            v-if="getActivityStatus(activity) === 'active'"
            class="seckill-btn"
            :disabled="!canParticipate(activity)"
            @click="participateSeckill(activity)"
          >
            立即抢购
          </button>
          <button v-else class="seckill-btn disabled">
            {{ getButtonText(activity) }}
          </button>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      activities: [],
      loading: false
    }
  },
  onLoad() {
    this.getCurrentActivities()
  },
  methods: {
    async getCurrentActivities() {
      this.loading = true
      try {
        const response = await uni.request({
          url: 'http://localhost:8080/user/seckill/activity/current',
          method: 'GET'
        })
        
        if (response.data.code === 1) {
          this.activities = response.data.data
        }
      } catch (error) {
        console.error('获取秒杀活动失败', error)
        uni.showToast({
          title: '获取活动失败',
          icon: 'none'
        })
      } finally {
        this.loading = false
      }
    },
    
    async participateSeckill(activity) {
      try {
        const response = await uni.request({
          url: `http://localhost:8080/user/seckill/activity/participate/${activity.id}`,
          method: 'POST',
          data: { quantity: 1 }
        })
        
        if (response.data.code === 1) {
          uni.showToast({
            title: response.data.data,
            icon: 'success'
          })
          this.getCurrentActivities()
        } else {
          uni.showToast({
            title: response.data.msg,
            icon: 'none'
          })
        }
      } catch (error) {
        console.error('参与秒杀失败', error)
        uni.showToast({
          title: '参与失败，请重试',
          icon: 'none'
        })
      }
    },
    
    getActivityStatus(activity) {
      const now = new Date()
      const startTime = new Date(activity.startTime)
      const endTime = new Date(activity.endTime)
      
      if (now < startTime) return 'not-started'
      if (now > endTime) return 'ended'
      return 'active'
    },
    
    getStockPercent(activity) {
      return ((activity.stock - activity.soldCount) / activity.stock) * 100
    },
    
    canParticipate(activity) {
      return activity.stock > activity.soldCount && activity.status === 1
    },
    
    getButtonText(activity) {
      const status = this.getActivityStatus(activity)
      switch (status) {
        case 'not-started': return '未开始'
        case 'ended': return '已结束'
        default: return '立即抢购'
      }
    },
    
    getCountdown(endTime) {
      const now = new Date().getTime()
      const end = new Date(endTime).getTime()
      const timeLeft = Math.max(0, end - now)
      
      const hours = Math.floor(timeLeft / (1000 * 60 * 60))
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60))
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000)
      
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
    }
  }
}
</script>

<style scoped>
.seckill-container {
  padding: 20rpx;
  background: #f5f5f5;
  min-height: 100vh;
}

.seckill-header {
  text-align: center;
  margin-bottom: 30rpx;
  padding: 30rpx;
  background: #fff;
  border-radius: 10rpx;
}

.title {
  font-size: 36rpx;
  color: #f56c6c;
  font-weight: bold;
  display: block;
  margin-bottom: 10rpx;
}

.subtitle {
  font-size: 24rpx;
  color: #909399;
}

.seckill-item {
  background: #fff;
  border-radius: 10rpx;
  margin-bottom: 20rpx;
  padding: 20rpx;
  display: flex;
  align-items: center;
}

.product-image {
  width: 120rpx;
  height: 120rpx;
  border-radius: 8rpx;
  margin-right: 20rpx;
}

.product-info {
  flex: 1;
}

.product-name {
  font-size: 28rpx;
  color: #303133;
  font-weight: bold;
  display: block;
  margin-bottom: 10rpx;
}

.product-desc {
  font-size: 22rpx;
  color: #909399;
  display: block;
  margin-bottom: 15rpx;
}

.price-info {
  display: flex;
  align-items: center;
}

.original-price {
  text-decoration: line-through;
  color: #909399;
  font-size: 24rpx;
  margin-right: 15rpx;
}

.seckill-price {
  color: #f56c6c;
  font-size: 32rpx;
  font-weight: bold;
}

.seckill-action {
  width: 200rpx;
  text-align: center;
}

.stock-info {
  margin-bottom: 15rpx;
}

.stock-text {
  font-size: 20rpx;
  color: #606266;
  display: block;
  margin-bottom: 8rpx;
}

.progress-bar {
  width: 100%;
  height: 6rpx;
  background: #f0f0f0;
  border-radius: 3rpx;
  overflow: hidden;
}

.progress {
  height: 100%;
  background: linear-gradient(90deg, #f56c6c, #ff9a9a);
  transition: width 0.3s ease;
}

.time-info {
  margin-bottom: 15rpx;
}

.countdown {
  font-size: 20rpx;
  color: #f56c6c;
  font-weight: bold;
}

.ended {
  font-size: 20rpx;
  color: #909399;
}

.seckill-btn {
  width: 100%;
  height: 60rpx;
  background: #f56c6c;
  color: #fff;
  border: none;
  border-radius: 30rpx;
  font-size: 24rpx;
  font-weight: bold;
}

.seckill-btn.disabled {
  background: #c0c4cc;
  color: #fff;
}
</style>
```

---

## 测试和优化

### 1. 功能测试

#### 1.1 单元测试
- 测试秒杀参与逻辑
- 测试库存扣减
- 测试并发控制

#### 1.2 集成测试
- 测试前后端接口
- 测试数据库操作
- 测试Redis缓存

#### 1.3 压力测试
- 模拟高并发场景
- 测试系统性能
- 验证防超卖机制

### 2. 性能优化

#### 2.1 缓存优化
- 合理设置缓存过期时间
- 使用缓存预热
- 避免缓存穿透

#### 2.2 数据库优化
- 添加必要索引
- 优化SQL查询
- 使用连接池

#### 2.3 系统优化
- 使用异步处理
- 合理设置线程池
- 监控系统资源

### 3. 监控告警

#### 3.1 业务监控
- 秒杀参与成功率
- 库存变化趋势
- 用户参与行为

#### 3.2 系统监控
- Redis性能指标
- 数据库连接数
- 服务器资源使用

---

## GitHub Pages 部署指南

### 1. 准备工作

#### 1.1 创建GitHub仓库
```bash
# 在GitHub上创建一个新的仓库，命名为 yin123-ybh.github.io
# 或者使用现有的仓库
```

#### 1.2 克隆仓库到本地
```bash
git clone https://github.com/yin123-ybh/yin123-ybh.github.io.git
cd yin123-ybh.github.io
```

### 2. 创建博客文章

#### 2.1 创建文章目录结构
```bash
mkdir -p _posts/2024
mkdir -p assets/images
```

#### 2.2 创建文章文件
```bash
# 将第一部分文章复制到_posts目录
cp "/Users/yin/Downloads/秒杀活动功能完善指南-第一部分.md" "_posts/2024/2024-01-15-秒杀活动功能完善指南-第一部分.md"

# 将第二部分文章复制到_posts目录
cp "/Users/yin/Downloads/秒杀活动功能完善指南-第二部分.md" "_posts/2024/2024-01-15-秒杀活动功能完善指南-第二部分.md"
```

#### 2.3 添加Jekyll Front Matter
在每个Markdown文件开头添加：

```yaml
---
layout: post
title: "秒杀活动功能完善指南 - 第一部分"
date: 2024-01-15 10:00:00 +0800
categories: [技术, 后端开发, 秒杀系统]
tags: [Spring Boot, Redis, 分布式锁, 高并发]
author: yin123-ybh
---
```

### 3. 配置Jekyll

#### 3.1 创建_config.yml
```yaml
# 文件路径: _config.yml
title: "Yin123的技术博客"
description: "分享技术心得，记录成长历程"
author: "yin123-ybh"
email: "your-email@example.com"

# 网站设置
url: "https://yin123-ybh.github.io"
baseurl: ""

# 构建设置
markdown: kramdown
highlighter: rouge
theme: minima

# 插件
plugins:
  - jekyll-feed
  - jekyll-sitemap
  - jekyll-seo-tag

# 分页
paginate: 5
paginate_path: "/page:num/"

# 社交链接
github_username: yin123-ybh
twitter_username: your_twitter
```

#### 3.2 创建index.html
```html
<!-- 文件路径: index.html -->
---
layout: default
---

<div class="home">
  <h1 class="page-heading">最新文章</h1>
  
  <ul class="post-list">
    {% for post in site.posts %}
      <li>
        <span class="post-meta">{{ post.date | date: "%Y-%m-%d" }}</span>
        <h2>
          <a class="post-link" href="{{ post.url | relative_url }}">{{ post.title }}</a>
        </h2>
        <p>{{ post.excerpt | strip_html | truncate: 200 }}</p>
      </li>
    {% endfor %}
  </ul>
</div>
```

### 4. 部署到GitHub Pages

#### 4.1 提交代码
```bash
git add .
git commit -m "添加秒杀活动功能完善指南"
git push origin main
```

#### 4.2 启用GitHub Pages
1. 进入GitHub仓库设置页面
2. 找到"Pages"选项
3. 选择"Deploy from a branch"
4. 选择"main"分支
5. 选择"/ (root)"文件夹
6. 点击"Save"

#### 4.3 访问博客
等待几分钟后，访问：`https://yin123-ybh.github.io`

### 5. 自定义主题（可选）

#### 5.1 使用Jekyll主题
```bash
# 添加主题到Gemfile
echo "gem 'minima'" >> Gemfile

# 或者使用其他主题
echo "gem 'jekyll-theme-clean-blog'" >> Gemfile
```

#### 5.2 自定义样式
创建`_sass/custom.scss`文件：
```scss
// 自定义样式
.post-content {
  h1, h2, h3, h4, h5, h6 {
    color: #2c3e50;
    margin-top: 2em;
    margin-bottom: 1em;
  }
  
  code {
    background-color: #f8f9fa;
    padding: 2px 4px;
    border-radius: 3px;
  }
  
  pre {
    background-color: #f8f9fa;
    padding: 1em;
    border-radius: 5px;
    overflow-x: auto;
  }
}
```

### 6. 自动化部署

#### 6.1 使用GitHub Actions
创建`.github/workflows/jekyll.yml`：
```yaml
name: Jekyll site CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Ruby
      uses: actions/setup-ruby@v1
      with:
        ruby-version: '2.7'
        
    - name: Install dependencies
      run: |
        gem install bundler
        bundle install
        
    - name: Build site
      run: bundle exec jekyll build
      
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./_site
```

---

## 总结

第二部分涵盖了秒杀活动功能的完整实现，包括：

1. **前端界面开发** - Vue.js管理界面和用户界面
2. **微信小程序集成** - 移动端秒杀功能
3. **测试和优化** - 功能测试和性能优化
4. **GitHub Pages部署** - 完整的博客部署指南

通过这两部分指南，你可以：
- 掌握高并发秒杀系统的核心技术
- 学会前后端分离开发
- 了解微信小程序开发
- 搭建个人技术博客

按照指南逐步实现，你就能构建出一个完整的秒杀活动系统，并将技术心得分享到博客上！

---

*返回阅读：[秒杀活动功能完善指南 - 第一部分](./秒杀活动功能完善指南-第一部分.md)*
